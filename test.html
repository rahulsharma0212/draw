<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Draw a polygon and calculate its area</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link rel="stylesheet" href="./style.css" />
    <script src="./draw.js"></script>
    <script src="./truf.js"></script>
    <script src="https://apis.mapmyindia.com/advancedmaps/api/44ce1a15d05ddf735b82f88d97fec3ae/map_sdk?layer=vector&v=2.0"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <style>
      .calculation-box {
        height: 75px;
        width: 150px;
        position: absolute;
        bottom: 40px;
        left: 10px;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 15px;
        text-align: center;
      }

      p {
        font-family: "Open Sans";
        margin: 0;
        font-size: 13px;
      }
    </style>

    <div id="map"></div>
    <div class="calculation-box">
      <p>Click the map to draw a polygon.</p>
      <div id="calculated-area"></div>
    </div>

    <script>
      /*mapboxgl.accessToken = 'pk.eyJ1IjoicmFodWwwMjEyIiwiYSI6ImNreWExdXN3OTAxODEydXFudXFrZDkycWkifQ.1DeOSOxVvgoIUTBqxbqp5Q';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/satellite-v9', // style URL
        center: [-91.874, 42.76], // starting position [lng, lat]
        zoom: 12 // starting zoom
    });*/

      var map = new MapmyIndia.Map("map", {
        center: [37.7608307053876, -122.42388725280762],
        zoom: 13.438345980401118,
        zoomControl: true,
        location: true,
        // backgroundColor:"red",
      });

      var singlePoly = {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            properties: {},
            geometry: {
              type: "Polygon",
              coordinates: [
              [
    [
        -122.42598706623318,
        37.75995638198329
    ],
    [
        -122.42702819587768,
        37.76073425222272
    ],
    [
        -122.42647902859284,
        37.7620819382731
    ],
    [
        -122.42778330089439,
        37.76317634981815
    ],
    [
        -122.42567815963538,
        37.76417125535232
    ],
    [
        -122.42233739198518,
        37.76391800794059
    ],
    [
        -122.42115897051956,
        37.76441545739236
    ],
    [
        -122.42027801466655,
        37.76332106418198
    ],
    [
        -122.42068989013028,
        37.76194626629248
    ],
    [
        -122.42075853604102,
        37.760499083013144
    ],
    [
        -122.4233441986745,
        37.75986593142518
    ],
    [
        -122.42598706623318,
        37.75995638198329
    ]
]
              ],
            },
          },
        ],
      };

      /* [-122.41667219958222, 37.761504269115065],
                [-122.41761597753322, 37.76543563970377],
                [-122.41703519110192, 37.7683625098346],
                [-122.41460314791962, 37.77022761174277],
                [-122.41224370304153, 37.76862075752001],
                [-122.41082803611472, 37.764488686331646],
                [-122.40865008699629, 37.76664083555086],
                [-122.40422159045559, 37.766181715639135],
                [-122.40313261589654, 37.763799985354154],
                [-122.40462088112753, 37.76233647448498],
                [-122.407706309045, 37.76159035976012],
                [-122.41217110473767, 37.76153296600752],
                [-122.41667219958222, 37.761504269115065], */

      var makeTriangles = function () {
        var triangles = turf.tesselate(singlePoly.features[0]);
        var centerPoints = [];
        for (i = 0; i < triangles.features.length; i++) {
          var el = triangles.features[i];
          var center = turf.centerOfMass(el);
          centerPoints.push(center);
          //console.log(center);
        }
        var fc = turf.featureCollection(centerPoints);
        console.log(fc);

        // lines
        //  centerPoints
        map.addLayer({
          id: "testPoints",
          type: "line",
          source: {
            type: "geojson",
            data: triangles,
          },
          paint: {
            "line-color": "#333",
            "line-opacity": 1,
          },
        });
        // points
        map.addLayer({
          id: "testPointCenter",
          type: "circle",
          source: {
            type: "geojson",
            data: fc,
          },
          paint: {
            "circle-color": "#333",
            "circle-radius": 5,
          },
        });
      };
      map.on("load", function () {
        makeTriangles();
      });
    </script>
  </body>
</html>
